<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2048 game</title>
    <style>
        table {
            border-collapse:collapse;
            background-color:brown;
        }

        table td {
            border: 1px dashed black;
            text-align: center;
            vertical-align:center;
            width:125px;
            height:125px;
        }

        #time {
            padding:1rem;
            margin:1rem;
            
        }
    </style>
    <script>

        /*
            [x] Resolver problema com a inserção de novos elementos sem movimento de peças;
            [x] Resolver problema de movimentos travados de peças para a direita e para a esquerda;
            [x] Resolver problema de movimentos recursivos que faz com que as peças façam combos (combinações) em uma única jogada;
            [x] Resolver problema ou bug referente à variável Game.occupied (não está sumindo peças);
            [] Resolver problema que faz com que peças enfileiradas não sejam completamente postas de um lado para o outro em cascata;
            [] Resolver problema de mudança precoce de números que faz com que as peças venham a mudar radicalmente os números com poucas jogadas;
        */
        
        function Squares (position, number, inserted) {
            this.position = position;
            this.number = number;
            this.inserted = inserted;

            /*
            this.insert = function (number) {
                this.number = number; // Se refere ao número que cada caixa irá ter como identificador 
                let element = document.getElementById(this.position.toString());
                if (Game.DEBUG)
                    console.log("TEST this.position: ", this.position, "this.number", this.number)
                element.innerHTML = number.toString();
                if (this.inserted != true)
                    this.inserted = true;
            }

            this.remove_position = function() {
                if(this.inserted) {
                    let element = document.getElementById(this.position.toString());
                    element.innerHTML = "";
                    this.inserted = false;
                }
            }

            this.change_number = function(number) {
                let element = document.getElementById(this.position.toString());
                this.number = number;
                element.innerHTML = number.toString();
            }
            */

            this.insert = function (number) {
                this.number = number; // Se refere ao número que cada caixa irá ter como identificador 
                let element = document.getElementById(this.position.toString());
                let table = document.getElementById("main-table");
                let div = document.createElement("div");
                let text = document.createTextNode(this.number.toString());
                div.appendChild(text);
                div.id = "A"+this.position.toString();
                div.style.width = "125px";
                div.style.height = "125px";
                div.style.borderRadius = "20px";
                //div.style.backgroundColor = "GoldenRod";
                div.style.backgroundColor = "goldenRod"
                div.style.position = "absolute";
                div.style.display = "flex";
                div.style.alignItems = "center";
                div.style.justifyContent = "center";
                div.style.fontWeight = "bold";
                div.style.color = "white";
                //div.style.transform = "translate("+element.offsetLeft.toString()+","+element.offsetLeft.toString()+")";
                div.style.top = (element.offsetTop+9).toString()+"px";
                div.style.left = (element.offsetLeft+8).toString()+"px";
                document.body.appendChild(div);

                if (Game.DEBUG)
                    console.log("TEST this.position: ", this.position, "this.number", this.number)
                //element.innerHTML = number.toString();
                if (this.inserted != true)
                    this.inserted = true;
            }

            this.move_transition = function (x,y, to_left) {
                div = document.getElementById("A"+this.position.toString());
                if (to_left) {
                    div.style.transition = `left ${Math.floor(Game.time/1000)}s`;
                    div.style.left = x.toString()+"px";
                } 
                else {
                    div.style.transition = `top ${Math.floor(Game.time/1000)}s`;
                    div.style.top = y.toString()+"px";
                }
            }
            
            this.remove_position = function() {
                if(this.inserted) {
                    //let element = document.getElementById(this.position.toString());
                    //element.innerHTML = "";
                    this.inserted = false;
                    let element = document.getElementById("A"+this.position.toString());
                    document.body.removeChild(element);
                }
            }

            this.change_number = function(number) {
                //let element = document.getElementById(this.position.toString());
                //element.innerHTML = number.toString();
                this.number = number;
                let element = document.getElementById("A"+this.position.toString());
                element.innerHTML = number.toString();
                if (Game.DEBUG)
                    console.log(`Element: ${element}, Changing the square number and color...\nnumber:  ${number}, Game.square_color[number]:  ${Game.square_color[number]}`);
                if (number <= Game.NUMBER_COLOR_LIMIT)
                    element.style.backgroundColor = Game.square_color[number];
            }
        }

        var Game = {
            DEBUG : true,
            ELEMENTS_NUMBER : 16,
            WIDTH: 4,
            HEIGHT : 4,
            NUMBER_COLOR_LIMIT : 4096,
            square_array : Array(),
            occupied : 0,
            time: 1000,
            number_to_remove : new Set,
            number_to_change : new Set,
            square_color : {2: "goldenrod", 4 : "orange", 8: "Chocolate", 16: "red", 32 : "YellowGreen", 64 : "Green", 128 : "MediumSeaGreen", 256 : "Teal", 512 : "Aqua", 1024 : "Cyan", 2048 : "white", 4096 : "Violet"},

            prepare : function () {
                document.body.onkeypress = function () {

                    if (Game.DEBUG) {
                        console.log("before (Game.square_array): ")
                        let count = 0;
                        for(let i in Game.square_array) {
                            for(let j in Game.square_array[i]) {
                                if(typeof(Game.square_array[i][j]) != 'function')
                                console.log(`Game.square_array[${count}].${j} = ${Game.square_array[i][j]}`);
                            }
                            count++;
                        }
                    }

                    let move_occured = false;

                    if (event.keyCode == '119' || event.keyCode == '38' || event.keyCode == "87") {
                        for (let i = 4; i < Game.ELEMENTS_NUMBER; i++) {
                            if (Game.DEBUG)
                                console.log ("W TEST i: ", i);
                            if (Game.square_array[i].inserted) {
                                let table_position = Game.square_array[i].position; // We take a position of a table cell
                                if (Game.DEBUG)
                                    console.log ("W TEST table_position: ", table_position);
                                // We want to check each element to determine whether or not to bring up
                                // If an element is 15, elements 11, 7 and 4 must be analyzed
                                table_position-=4; // We point the address of the cells at the top of the table
                                square_position = -1;
                                while(table_position >= 0) { // We move through the cells of the table in an upward direction
                                    //let real_position = Game.search_for_position(table_position);
                                    if (Game.DEBUG)
                                        console.log("W TEST1 before table_position: ", table_position, "square_position: ", square_position);
                                    if (!Game.square_array[table_position].inserted) { // If the cell contains no values, the cell will be a candidate for use
                                        if (Game.DEBUG)
                                            console.log("W TEST !Game.square_array[table_position].inserted ENTERED");
                                        square_position = table_position;
                                        move_occured = true;
                                    } else {
                                        if (Game.square_array[table_position].number == Game.square_array[i].number) {
                                            if(Game.DEBUG)
                                                console.log("W TEST Game.square_array[table_position].number == Game.square_array[i].number ENTERED");
                                            square_position = table_position;
                                            Game.number_to_change.add(square_position);
                                            if (Game.DEBUG)
                                                console.log("W TEST Game.number_to_change: ", Game.number_to_change);
                                            setTimeout(Game.change_number_delay, Game.time);
                                            let X = 125*(square_position-4*Math.floor(square_position/4))+9;
                                            let Y = 125*(Math.floor(square_position / 4)) +9;
                                            if (Game.DEBUG)
                                                console.log("W TEST i: ", i, "square_position: ", square_position, "X: " ,X, "Y: ", Y);
                                            Game.square_array[i].move_transition(X, Y, false);
                                            //Game.square_array[i].inserted = false;
                                            Game.number_to_remove.add(i);
                                            if (Game.DEBUG)
                                                console.log("W TEST Game.number_to_remove: ", Game.number_to_remove);
                                            setTimeout(Game.remove_square_delay,Game.time);
                                            square_position = -1;
                                            move_occured = true;
                                            //Game.exchange_data(i, square_position); 
                                        }
                                        break;
                                    }
                                    table_position-=4;
                                    if (Game.DEBUG)
                                        console.log("W TEST1 after table_position: ", table_position, "square_position: ", square_position);
                                }

                                if(Game.DEBUG)
                                    console.log("W TEST2 table_position: ", table_position, "square_position: ", square_position);
                                
                                if (square_position != -1) {
                                    //Game.square_array[square_position].insert(Game.square_array[i].number);
                                    //Game.square_array[i].remove_position();
                                    let X = 125*(square_position-4*(Math.floor(square_position/4)))+9;
                                    let Y = 125*(Math.floor(square_position / 4)) +9;
                                    if (Game.DEBUG)
                                        console.log("W TEST i: ", i, "square_position: ", square_position, "X: " ,X, "Y: ", Y);
                                    Game.square_array[i].move_transition(X, Y, false);
                                    Game.square_array[i].inserted = false;
                                    Game.exchange_data(i, square_position);
                                }
                            }
                        }
                        
                        if (Game.DEBUG) {
                            console.log("after (Game.square_array): ");
                            let count = 0;
                            for(let i in Game.square_array) {
                                for(let j in Game.square_array[i]) {
                                    if(typeof(Game.square_array[i][j]) != 'function')
                                    console.log(`Game.square_array[${count}].${j} = ${Game.square_array[i][j]}`);
                                }
                                count++;
                            }
                        }
                        //console.log(`Game.square_array[${i}]: ${Game.square_array[i]}`);

                        if (Game.DEBUG)
                            console.log("/////");

                    } else 
                    if (event.keyCode == '97' || event.keyCode == '65' || event.keyCode == '37') {
                        
                        for (let i = 0; i < Game.ELEMENTS_NUMBER; i++) {
                            if (Game.DEBUG)
                                console.log ("A TEST i: ", i);
                            if (Game.square_array[i].inserted) {
                                let table_position = Game.square_array[i].position; // We take a position of a table cell
                                if (Game.DEBUG)
                                    console.log ("A TEST table_position: ", table_position);
                                // We want to check each element to determine whether or not to bring up
                                // If an element is 5, elements 6 and 7 must be analyzed
                                table_position-=1; // We point the address of the cells at the right of the table
                                square_position = -1;
                                while(table_position >= Game.WIDTH * (Math.floor(i/Game.WIDTH))) { // We move through the cells of the table in a right direction
                                    //let real_position = Game.search_for_position(table_position);
                                    if (Game.DEBUG)
                                        console.log("A TEST1 table_position: ", table_position, "square_position: ", square_position);
                                    if (!Game.square_array[table_position].inserted) { // If the cell contains no values, the cell will be a candidate for use
                                        if (Game.DEBUG)
                                            console.log("A TEST !Game.square_array[table_position].inserted ENTERED");
                                        square_position = table_position;
                                        move_occured = true;
                                    } else {
                                        if (Game.square_array[table_position].number == Game.square_array[i].number) {
                                            if(Game.DEBUG)
                                                console.log("A TEST Game.square_array[table_position].number == Game.square_array[i].number ENTERED");
                                            square_position = table_position;
                                            Game.number_to_change.add(square_position);
                                            if (Game.DEBUG)
                                                console.log("A TEST Game.number_to_change: ", Game.number_to_change);
                                            setTimeout(Game.change_number_delay, Game.time);
                                            let X = 125*(square_position-4*Math.floor(square_position/4))+9;
                                            let Y = 125*(Math.floor(square_position / 4)) +9;
                                            if (Game.DEBUG)
                                                console.log("A TEST i: ", i, "square_position: ", square_position, "X: " ,X, "Y: ", Y);
                                            Game.square_array[i].move_transition(X, Y, true);
                                            //Game.square_array[i].inserted = false;
                                            Game.number_to_remove.add(i);
                                            if (Game.DEBUG)
                                                console.log("A TEST Game.number_to_remove: ", Game.number_to_remove);
                                            setTimeout(Game.remove_square_delay,Game.time);
                                            square_position = -1;
                                            move_occured = true;
                                            //Game.exchange_data(i, square_position);
                                        }
                                        break;
                                    }
                                    table_position-=1;
                                    if (Game.DEBUG)
                                        console.log("A TEST1 after table_position: ", table_position, "square_position: ", square_position);
                                }

                                if(Game.DEBUG)
                                    console.log("A TEST2 table_position: ", table_position, "square_position: ", square_position);
                                
                                if (square_position != -1) {
                                    //Game.square_array[square_position].insert(Game.square_array[i].number);
                                    //Game.square_array[i].remove_position();
                                    let X = 125*(square_position-4*(Math.floor(square_position/4)))+9;
                                    let Y = 125*(Math.floor(square_position / 4)) +9;
                                    if (Game.DEBUG)
                                        console.log("A TEST i: ", i, "square_position: ", square_position, "X: " ,X, "Y: ", Y);
                                    Game.square_array[i].move_transition(X, Y, true);
                                    Game.exchange_data(i, square_position);
                                    
                                }
                            }
                        }
                        
                        if (Game.DEBUG) {
                            console.log("after (Game.square_array): ");
                            let count = 0;
                            for(let i in Game.square_array) {
                                for(let j in Game.square_array[i]) {
                                    if(typeof(Game.square_array[i][j]) != 'function')
                                    console.log(`Game.square_array[${count}].${j} = ${Game.square_array[i][j]}`);
                                }
                                count++;
                            }
                        }

                        if (Game.DEBUG)
                            console.log("/////");
                    } else 
                    if (event.keyCode == '115' || event.keyCode == '40' || event.keyCode == '83') {
                        for (let i = Game.ELEMENTS_NUMBER -5; i >= 0; i--) {
                            if (Game.DEBUG)
                                console.log ("i: ", i);
                            if (Game.square_array[i].inserted) {
                                let table_position = Game.square_array[i].position; // We take a position of a table cell
                                if (Game.DEBUG)
                                    console.log ("S TEST table_position: ", table_position);
                                // We want to check each element to determine whether or not to bring up
                                // If an element is 3, elements 7, 11 and 15 must be analyzed
                                table_position+=4; // We point the address of the cells at the bottom of the table
                                square_position = -1;
                                while(table_position <= Game.ELEMENTS_NUMBER -1) { // We move through the cells of the table in an forward direction
                                    if (Game.DEBUG)
                                        console.log("S TEST1 table_position: ", table_position, "square_position: ", square_position);
                                    if (!Game.square_array[table_position].inserted) { // If the cell contains no values, the cell will be a candidate for use
                                        if (Game.DEBUG)
                                            console.log("S TEST !Game.square_array[table_position].inserted ENTERED");
                                        square_position = table_position;
                                        move_occured = true;
                                    } else {
                                        if (Game.square_array[table_position].number == Game.square_array[i].number) {
                                            if(Game.DEBUG)
                                                console.log("S TEST Game.square_array[table_position].number == Game.square_array[i].number ENTERED");
                                            square_position = table_position;
                                            Game.number_to_change.add(square_position);
                                            if (Game.DEBUG)
                                                console.log("S TEST Game.number_to_change: ", Game.number_to_change);
                                            setTimeout(Game.change_number_delay, Game.time);
                                            let X = 125*(square_position-4*Math.floor(square_position/4))+9;
                                            let Y = 125*(Math.floor(square_position / 4)) +18;
                                            if (Game.DEBUG) {
                                                console.log("S TEST i: ", i, "square_position: ", square_position, "X: " ,X, "Y: ", Y);
                                            }
                                            Game.square_array[i].move_transition(X, Y, false);
                                            //Game.square_array[i].inserted = false;
                                            Game.number_to_remove.add(i);
                                            if (Game.DEBUG)
                                                console.log("S TEST Game.number_to_remove: ", Game.number_to_remove);
                                            setTimeout(Game.remove_square_delay,Game.time);
                                            square_position = -1;
                                            move_occured = true;
                                            //Game.exchange_data(i, square_position);
                                        }
                                        break;
                                    }
                                    table_position+=4;
                                    if (Game.DEBUG)
                                        console.log("S TEST1 after table_position: ", table_position, "square_position: ", square_position);
                                }
                                if(Game.DEBUG)
                                    console.log("S TEST2 table_position: ", table_position, "square_position: ", square_position);
                                
                                if (square_position != -1) {
                                    //Game.square_array[square_position].insert(Game.square_array[i].number);
                                    //Game.square_array[i].remove_position();
                                    let X = 125*(square_position-4*(Math.floor(square_position/4)))+9;
                                    let Y = 125*(Math.floor(square_position / 4)) +18;
                                    if (Game.DEBUG)
                                        console.log("S TEST i: ", i, "square_position: ", square_position, "X: " ,X, "Y: ", Y);
                                    Game.square_array[i].move_transition(X, Y, false);
                                    Game.exchange_data(i, square_position);
                                }
                            }
                        }

                        if (Game.DEBUG) {
                            console.log("after (Game.square_array): ");
                            let count = 0;
                            for(let i in Game.square_array) {
                                for(let j in Game.square_array[i]) {
                                    if(typeof(Game.square_array[i][j]) != 'function')
                                    console.log(`Game.square_array[${count}].${j} = ${Game.square_array[i][j]}`);
                                }
                                count++;
                            }
                        }

                        if (Game.DEBUG)
                            console.log("/////");
                    } else 
                    if (event.keyCode == '100' || event.keyCode == '68' || event.keyCode == '39') {
                        for (let i = Game.ELEMENTS_NUMBER -1; i >= 0; i--) {
                            if (Game.DEBUG)
                                console.log ("D TEST i: ", i);
                            if (Game.square_array[i].inserted) {
                                let table_position = Game.square_array[i].position; // We take a position of a table cell
                                if (Game.DEBUG)
                                    console.log ("D TEST table_position: ", table_position);
                                // We want to check each element to determine whether or not to bring up
                                // If an element is 10, elements 9 and 8 must be analyzed
                                table_position+=1; // We point the address of the cells at the right of the table
                                square_position = -1;
                                while(table_position < Game.WIDTH * (Math.floor(i/Game.WIDTH)+1)) { // We move through the cells of the table in a right direction
                                    //let real_position = Game.search_for_position(table_position);
                                    if (Game.DEBUG)
                                        console.log("D TEST1 table_position: ", table_position, "square_position: ", square_position);
                                    if (!Game.square_array[table_position].inserted) { // If the cell contains no values, the cell will be a candidate for use
                                        if (Game.DEBUG)
                                            console.log("D TEST !Game.square_array[table_position].inserted ENTERED");
                                        square_position = table_position;
                                        move_occured = true;
                                    } else {
                                        if (Game.DEBUG)
                                            console.log("D TEST Game.square_array[table_position].inserted ENTERED");
                                        if (Game.square_array[table_position].number == Game.square_array[i].number) {
                                            if(Game.DEBUG)
                                                console.log("D TEST Game.square_array[table_position].number == Game.square_array[i].number ENTERED");
                                            square_position = table_position;
                                            Game.number_to_change.add(square_position);
                                            if (Game.DEBUG)
                                                console.log("D TEST Game.number_to_change: ", Game.number_to_change);
                                            setTimeout(Game.change_number_delay, Game.time);
                                            let X = 125*(square_position-4*Math.floor(square_position/4))+9;
                                            let Y = 125*(Math.floor(square_position / 4)) +9;
                                            if (Game.DEBUG)
                                                console.log("D TEST i: ", i, "square_position: ", square_position, "X: " ,X, "Y: ", Y);
                                            Game.square_array[i].move_transition(X, Y, true);
                                            //Game.square_array[i].inserted = false;
                                            Game.number_to_remove.add(i);
                                            if (Game.DEBUG)
                                                console.log("D TEST Game.number_to_remove: ", Game.number_to_remove);
                                            setTimeout(Game.remove_square_delay,Game.time);
                                            square_position = -1;
                                            move_occured = true;
                                            //Game.exchange_data(i, square_position);
                                        }
                                        break;
                                    }
                                    table_position+=1;
                                    if (Game.DEBUG)
                                        console.log("D TEST1 after table_position: ", table_position, "square_position: ", square_position);
                                }

                                if(Game.DEBUG)
                                    console.log("D TEST2 table_position: ", table_position, "square_position: ", square_position);
                                
                                if (square_position != -1) {
                                    //Game.square_array[square_position].insert(Game.square_array[i].number);
                                    //Game.square_array[i].remove_position();
                                    let X = 125*(square_position-4*(Math.floor(square_position/4)))+9;
                                    let Y = 125*(Math.floor(square_position / 4)) +9;
                                    if (Game.DEBUG)
                                        console.log("D TEST i: ", i, "square_position: ", square_position, "X: " ,X, "Y: ", Y);
                                    Game.square_array[i].move_transition(X, Y, true);
                                    Game.exchange_data(i, square_position);
                                }
                            }
                        }
                    
                        if (Game.DEBUG) {
                            let count = 0;
                            console.log("after (Game.square_array): ");
                            for(let i in Game.square_array) {
                                for(let j in Game.square_array[i]) {
                                    if(typeof(Game.square_array[i][j]) != 'function')
                                    console.log(`Game.square_array[${count}].${j} = ${Game.square_array[i][j]}`);
                                }
                                count++;
                            }
                        }

                        if (Game.DEBUG)
                            console.log("/////");
                    }

                    if (Game.DEBUG)
                    console.log("Before setTimeout");

                    if (move_occured) {
                        setTimeout(Game.insert_square,Game.time);
                        move_occured = false;
                    }

                    if (Game.DEBUG)
                        console.log("After setTimeout");
                    
                }

                for (let i = 0; i < Game.ELEMENTS_NUMBER; i++) {
                    Game.square_array.push(new Squares(i,0,false));
                }

                Game.insert_square();
            },

            key_pressed_pattern : function (int_i_value, int_operand_comparison, bool_is_less_than, bool_is_for_increment, bool_is_increment_of_four ) {
                for (let i = int_i_value; (bool_is_less_than? i < int_operand_comparison : i >= int_operand_comparison); (bool_is_for_increment? i++ : i--)) {
                    if (Game.DEBUG)
                        console.log ("TEST i: ", i);
                    if (Game.square_array[i].inserted) {
                        let table_position = Game.square_array[i].position; // We take a position of a table cell
                        if (Game.DEBUG)
                            console.log ("TEST table_position: ", table_position);
                        // We want to check each element to determine whether or not to bring up
                        // If an element is 10, elements 9 and 8 must be analyzed
                        table_position+= (bool_is_increment_of_four? 4 : 1); // We point the address of the cells at the right of the table
                        square_position = -1;
                        while(table_position < Game.WIDTH * (Math.floor(i/Game.WIDTH)+1)) { // We move through the cells of the table in a right direction
                            //let real_position = Game.search_for_position(table_position);
                            if (Game.DEBUG)
                                console.log("TEST1 table_position: ", table_position, "square_position: ", square_position);
                            if (!Game.square_array[table_position].inserted) { // If the cell contains no values, the cell will be a candidate for use
                                if (Game.DEBUG)
                                    console.log("TEST !Game.square_array[table_position].inserted ENTERED");
                                square_position = table_position;
                                move_occured = true;
                            } else {
                                if (Game.DEBUG)
                                    console.log("TEST Game.square_array[table_position].inserted ENTERED");
                                if (Game.square_array[table_position].number == Game.square_array[i].number) {
                                    if(Game.DEBUG)
                                        console.log("TEST Game.square_array[table_position].number == Game.square_array[i].number ENTERED");
                                    square_position = table_position;
                                    Game.number_to_change.add(square_position);
                                    if (Game.DEBUG)
                                        console.log("TEST Game.number_to_change: ", Game.number_to_change);
                                    setTimeout(Game.change_number_delay, Game.time);
                                    let X = 125*(square_position-4*Math.floor(square_position/4))+9;
                                    let Y = 125*(Math.floor(square_position / 4)) +9;
                                    if (Game.DEBUG)
                                        console.log("TEST i: ", i, "square_position: ", square_position, "X: " ,X, "Y: ", Y);
                                    Game.square_array[i].move_transition(X, Y, true);
                                    //Game.square_array[i].inserted = false;
                                    Game.number_to_remove.add(i);
                                    if (Game.DEBUG)
                                        console.log("TEST Game.number_to_remove: ", Game.number_to_remove);
                                    setTimeout(Game.remove_square_delay,Game.time);
                                    square_position = -1;
                                    move_occured = true;
                                    //Game.exchange_data(i, square_position);
                                }
                                break;
                            }
                            table_position+= (bool_is_increment_of_four? 4 : 1);
                            if (Game.DEBUG)
                                console.log("TEST1 after table_position: ", table_position, "square_position: ", square_position);
                        }

                        if(Game.DEBUG)
                            console.log("TEST2 table_position: ", table_position, "square_position: ", square_position);
                        
                        if (square_position != -1) {
                            //Game.square_array[square_position].insert(Game.square_array[i].number);
                            //Game.square_array[i].remove_position();
                            let X = 125*(square_position-4*(Math.floor(square_position/4)))+9;
                            let Y = 125*(Math.floor(square_position / 4)) +9;
                            if (Game.DEBUG)
                                console.log("TEST i: ", i, "square_position: ", square_position, "X: " ,X, "Y: ", Y);
                            Game.square_array[i].move_transition(X, Y, true);
                            Game.exchange_data(i, square_position);
                        }
                    }
                }
            
                if (Game.DEBUG) {
                    let count = 0;
                    console.log("after (Game.square_array): ");
                    for(let i in Game.square_array) {
                        for(let j in Game.square_array[i]) {
                            if(typeof(Game.square_array[i][j]) != 'function')
                            console.log(`Game.square_array[${count}].${j} = ${Game.square_array[i][j]}`);
                        }
                        count++;
                    }
                }

                if (Game.DEBUG)
                    console.log("/////");
            },

            insert_square : function () {
                if (Game.DEBUG)
                    console.log("Game.occupied: ", Game.occupied)
                let count = 0;
                let inserted = false;
                if (Game.occupied < Game.ELEMENTS_NUMBER) {
                    let number = parseInt(Game.ELEMENTS_NUMBER*Math.random()); // We will randomly choose an empty square to fill it with a number
                    while(!inserted) {
                        // Now we want to insert into a square the number
                        if (!Game.square_array[number].inserted) {
                            Game.square_array[number].insert(2);
                            inserted = true;
                            if (Game.DEBUG)
                                console.log("TEST inserting new element: ", number);
                        } else
                        number = parseInt(Game.ELEMENTS_NUMBER*Math.random());
                        count++;
                        if (count > Game.ELEMENTS_NUMBER * 2) {
                            break;
                        }
                    }

                    if (!inserted) { // If the element has not been previously inserted within a period of time, we will insert it manually using a for
                        for(let i = 0; i < Game.ELEMENTS_NUMBER; i++) {
                            if (!Game.square_array[i].inserted) {
                                Game.square_array[i].insert(2);
                                inserted = true;
                            }
                        }
                        if (Game.DEBUG) {
                            console.log("TEST Is not inserted, tried again...");
                        }
                    }

                    if (inserted) {
                        Game.occupied+= 1;
                        if (Game.DEBUG)
                            console.log("TEST incrementing Game.occupied: ", Game.occupied);
                    }
                        
                }
            },

            remove_square : function (number) {
                if (Game.occupied > 0 && Game.square_array[number].inserted) {
                    if (Game.DEBUG)
                    Game.square_array[number].remove_position();
                    Game.occupied--;
                    if (Game.DEBUG)
                        console.log("TEST decrementing Game.occupied: ", Game.occupied, "removing square (number): ", number);
                }
            },

            remove_square_delay : function () {
                for (let n of Game.number_to_remove)
                    Game.remove_square(n);
                Game.number_to_remove = new Set();
            },

            exchange_data : function (i, square_position) {
                //if (Game.square_array[i].inserted) {
                Game.square_array[square_position].number = Game.square_array[i].number;
                Game.square_array[i].inserted = false;
                if (Game.DEBUG)
                console.log(`Exchanging data between square ${i} and ${square_position}`)
                //}

                if (!Game.square_array[square_position].inserted)
                    Game.square_array[square_position].inserted = true;

                /*if (Game.DEBUG)
                    console.log("continue to exchanging data...");*/

                let div = document.getElementById("A"+i.toString());
                div.id = "A"+square_position.toString(); // Colocando a div com número i como quadrado square_position
            },

            change_number_delay : function () {
                for (let n of Game.number_to_change) {
                    console.log(`Changing number of square ${n} with number ${Game.square_array[n].number} to ${Game.square_array[n].number*2}`)
                    Game.square_array[n].change_number(Game.square_array[n].number *2);
                }
                Game.number_to_change = new Set();
            }
        }
    </script>
</head>
<body>
    <table id="main-table" width="500px" height="500px">
        <tbody>
            <tr>
                <td id="0"></td>
                <td id="1"></td>
                <td id="2"></td>
                <td id="3"></td>
            </tr>
            <tr>
                <td id="4"></td>
                <td id="5"></td>
                <td id="6"></td>
                <td id="7"></td>
            </tr>
            <tr>
                <td id="8"></td>
                <td id="9"></td>
                <td id="10"></td>
                <td id="11"></td>
            </tr>
            <tr>
                <td id="12"></td>
                <td id="13"></td>
                <td id="14"></td>
                <td id="15"></td>
            </tr>
        </tbody>
    </table>
    <script>
        Game.prepare();
    </script>
</body>
</html>